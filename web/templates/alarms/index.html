{% extends 'layout.html' %}

{% set menuid = 'alarms' %}

{% block title %} 故障管理 {% endblock %}

{% block head %} 
    <link rel="stylesheet" href="/static/css/alarm.css" type="text/css" media="all">
    <script type="text/javascript" >

    $(function(){
        $('#alarm-show-model').on('hide', function () {
           $('#alarm-show-body').html(''); 
        })
        $('#alarm-show-model').on('show', function () {
          alert("show");
        })
        alarms_form = $("#alarms-form");
        $("#alarm-clear-action").click(function() {
            var ids = alarms_form.find("input[name^=id]:checked");
            if(ids.length != 1){
                alert("请选择one Alarm!");
                return;
            }
            alarms_form.attr("action", "/alarms/clear/"+ids[0].value).submit();
        })
        $("#alarm-ack-action").click(function() {
            var ids = alarms_form.find("input[name^=id]:checked");
            if(ids.length != 1){
                alert("请选择one Alarm!");
                return;
            }
            alarms_form.attr("action", "/alarms/ack/"+ids[0].value).submit();
        })
    })
    </script>
{% endblock %}

{% from "_table_h.html" import render_table, render_screen_meta %}

{% block screen_meta %} 

{{ render_screen_meta(table) }}

<div id="screen-meta-links">
    <div id="contextual-help-link-wrap" class="hide-if-no-js screen-meta-toggle">
        <a href="#contextual-help-wrap" id="contextual-help-link"
        class="show-settings">帮助</a>
    </div>
    <div id="screen-options-link-wrap" class="hide-if-no-js screen-meta-toggle">
        <a href="#screen-options-wrap" id="show-settings-link"
        class="show-settings">显示选项</a>
    </div>
</div>

{% endblock %}

{% block content %}

<div class="row-fluid" style="margin-top:30px;">
    <div class="span2">
        {% set submenuid = 'alarms' %}
        {% include 'alarms/_sidebar.html' %}
    </div>

    <div class="span10">
        <form id="alarms-form" class="form-inline" action="/alarms" method="GET">

        <ul class="subsubsub">
            <li><a href="/alarms">全部<span class="count">({{all_count}})</span></a>|</li>
            {% for severity in severities %}
            <li class="alarm-{{ severity.name }}"><a {% if request.args['severity'] == severity.name %} class="current" {% endif %} href="/alarms?severity={{ severity.name }}">{{ severity.alias }}<span class="count">({{ severity.count }})</span></a> {% if not loop.last %} | {% endif %} </li>
            {% endfor %}
        </ul>
        <div class="tablenav top">
            <div class="alignleft actions">
                <div class="alignleft btn-group">
                    <a id="alarm-ack-action" class="btn btn-small" href="#">确认</a>
                    <a id="alarm-clear-action" class="btn btn-small" href="#">清除</a>
                </div>
            </div>
            <div class="alignleft filters">
                <select name="query_id" class="input-medium">
                    <option value="">全部告警</option>
                    {% for q in queries %}
                        <option value="{{q.id}}">{{q.name}}</option>
                    {% endfor %}
                </select>
                <input type="text" name="nodelike" placeholder="Node Alias or Addr">
                <input type="submit" id="alarm-query-submit" class="btn btn-small" value="过滤">
            </div>
        </div>

        {{ render_table(table) }}

        <br class="clear">

        </form>

        <div id="alarm-show-model" class="modal hide" tabindex="-1" role="dialog">
          <div class="modal-header">
            <h3 id="alarm-show-header">Alarm Detail</h3>
          </div>
          <div id="alarm-show-body" class="modal-body"> </div>
          <div class="modal-footer">
            <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          </div>
        </div>
        
    </div>
</div>

{% endblock %}

